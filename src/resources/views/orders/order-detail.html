<template>
    <require from="styles/order-detail.css"></require>
    <require from="../calculator/event-view"></require>

    <ai-dialog id="order-detail">
        <ai-dialog-header>
            <h2>Order ${calculator.order._id}</h2>
        </ai-dialog-header>
        <ai-dialog-body>
            <form class="ui form segment">                
                <div class="two fields">
                    <div class="field">
                        <label>Customer</label>
                        <p>${calculator.order.customer.name}</p>
                    </div>
                    <div class="field">
                        <label>Arrival Date</label>
                        <div class="calendar" if.bind="canSaveChanges">
                            <span class="date-display">${dateDisplay}</span>
                        </div>
                        <p if.bind="!canSaveChanges">${dateDisplay}</p>
                    </div>
                </div>
                <div class="three fields">
                    <div class="field">
                        <label>Plant</label>
                        <p>${calculator.order.plant.name}</p>
                    </div>
                    <div class="field">
                        <label for="pots-per-case">Pots Per Case</label>
                        <input type="number" name="pots-per-case" id="pots-per-case" value.bind="calculator.potsPerCase" required>
                    </div>
                    <div class="field">
                        <label for="quantity">Quantity</label>
                        <input type="number" id="quantity" name="quantity" value.bind="calculator.orderQuantity & debounce" if.bind="canSaveChanges" required>
                        <p if.bind="!canSaveChanges">${calculator.orderQuantity | numericFormat}</p>
                    </div>
                </div>

                <div class="ui divider"></div>

                <div class="ui toggle checkbox">
                    <input type="checkbox" name="root-in-prop-zone" id="root-in-prop-zone" checked.bind="calculator.rootInPropagationZone">
                    <label for="root-in-prop-zone">Root in B/C</label>
                </div>
                <div class="ui toggle checkbox right floated">
                    <input type="checkbox" name="partial-space" id="partial-space" checked.bind="calculator.partialSpace">
                    <label for="partial-space">Use partial spacing</label>
                </div>

                <table class="ui table">
                    <thead>
                        <tr>
                            <th class="center aligned">Event</th>
                            <th class="center aligned">Week</th>
                            <th class="center aligned">Tables</th>
                            <th class="center aligned" repeat.for="z of calculator.zones">${z.name}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr repeat.for="week of calculator.weeks">
                            <td>
                                <div class="ui ribbon label" if.bind="week.events.length">
                                    <event-view repeat.for="event of week.events" event.bind="event" calculator.bind="calculator"></event-view>
                                </div>
                            </td>
                            <td class="center aligned">${week.week.week}</td>
                            <td class="center aligned">${week.tables|numericFormat}</td>
                            <td class="center aligned ${week.zones[z].available < 0 ? 'negative' : 'positive'}" repeat.for="z of week.zones | keys">
                                ${week.zones[z].available}
                            </td>
                        </tr>
                    </tbody>
                    <tfoot if.bind="canSaveChanges">
                        <tr>
                            <td colspan="3">&nbsp;</td>
                            <td class="center aligned" repeat.for="z of calculator.zones">
                                <button click.trigger="setZone(z)" class="basic ui toggle icon button"
                                     hide.bind="z.isPropagationZone"
                                    class.bind="(z.name===calculator.order.zone.name) ? 'active' : ''"
                                    data-tooltip="${(z.name===calculator.order.zone.name) ? 'Clicking save will move the order to this zone.' : 'Click to move the order to this zone.'}">
                                    <i class="checkmark box icon" show.bind="z.canFit"></i>
                                    <i class="warning sign box icon" hide.bind="z.canFit"></i>
                                </button>
                                <span show.bind="z.isPropagationZone">&nbsp;</span>
                            </td>
                        </tr>
                    </tfoot>
                </table>

            </form>
        </ai-dialog-body>
        <ai-dialog-footer>
            <button class="ui basic red button left floated" click.delegate="delete()" data-tooltip="Click to Delete this Order" show.bind="canSaveChanges">
                <i class="trash button icon"></i>
                Delete
            </button>

            <button class="ui basic button" click.delegate="cancel()">${canSaveChanges ? 'Cancel' : 'Close'}</button>
            <button class="ui basic primary button" click.delegate="save()" show.bind="canSaveChanges">
                <i class="save button icon"></i>
                Save
            </button>
        </ai-dialog-footer>
    </ai-dialog>
</template>
